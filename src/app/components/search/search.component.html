<section id="cover" style="margin-top: 5%;
margin-bottom: 5%;">
    <div id="cover-caption">
        <div class="container">
            <div class="row text-white">
                <div class="col-xl-5 col-lg-6 col-md-8 col-sm-10 mx-auto text-center form p-4">
                    <div class="card">
                        <div class="card-header">
                            <h3>Search Products</h3>
                            <p *ngIf="datasaved" class="text-center errorMsg">{{message}}</p>
                        </div>
                        <div class="card-body">
                            <form [formGroup]="searchForm" (ngSubmit)="searchProducts();">
                                <div class="form-group text-left">
                                    <label for="product" class="links">Search<span class="required">*</span></label>
                                    <input type="text" formControlName="product" class="form-control"
                                        placeholder="Enter Product Name">
                                    <div *ngIf="search.product.touched && search.product.invalid" class="error">
                                        <div *ngIf="search.product.errors && search.product.errors.required">
                                            Product Name is <strong>required</strong>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" [disabled]="searchForm.invalid"
                                    class="btn login_btn">Search</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="container" style="margin-top: 5%;
margin-bottom: 5%;">
    <div class="responsive">
        <!-- Grid row -->
        <div class="row" *ngIf="productList?.productList?.length">
            <div class="col-md-12">
                <h3 class="mb-4">Products Search Results</h3>
            </div>
            <p-table [value]="productList?.productList">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Product ID</th>
                        <th>Product Number</th>
                        <th>Product Price</th>
                        <th>Product Description</th>
                        <th>Category</th>
                        <th>Available Quantity</th>
                        <th></th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-listofProduct>
                    <tr>
                        <td>{{listofProduct?.productId}}</td>
                        <td>{{listofProduct?.productName}}</td>
                        <td class="text-right">{{listofProduct?.productPrice | currency:'INR':true}}</td>
                        <td>{{listofProduct?.productDescription}}</td>
                        <td>{{listofProduct?.productCategory}}</td>
                        <td class="text-center">{{listofProduct?.productQuantity}}</td>
                        <td>
                            <button pButton type="button" label="Buy Now" class="ui-button-info"
                                (click)="buyNow(listofProduct?.productId)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>


        </div>
    </div>
</div>


<p-dialog header="Buy Product" [(visible)]="buyProduct" [modal]="true" [responsive]="true" [style]="{width: '500px'}">
    <form [formGroup]="buyProductForm">
        <div class="form-group text-left">
            <label for="name" class="links text-dark">Product Quantity<span class="required">*</span></label>
            <input type="text" formControlName="quantity" class="form-control" placeholder="Enter Quantity" required>
            <div *ngIf="product.quantity.touched && product.quantity.invalid" class="error">
                <div *ngIf="product.quantity.errors && product.quantity.errors.required ">
                    Quantity is <strong>required</strong>
                </div>
            </div>

        </div>
        <div class="form-group text-left">
            <label for="name" class="links text-dark">Card Number<span class="required">*</span></label>
            <input type="text" formControlName="cardNumber" class="form-control" placeholder="Enter Card Number"
                required>
            <div *ngIf="product.cardNumber.touched && product.cardNumber.invalid" class="error">
                <div *ngIf="product.cardNumber.errors && product.cardNumber.errors.required ">
                    Card Number is <strong>required</strong>
                </div>
            </div>

        </div>
        <div class="form-group text-left">
            <label for="name" class="links text-dark">CVV<span class="required">*</span></label>
            <input type="password" formControlName="cvv" class="form-control" placeholder="Enter CVV Number" required>
            <div *ngIf="product.cvv.touched && product.cvv.invalid" class="error">
                <div *ngIf="product.cvv.errors && product.cvv.errors.required ">
                    CVV Number is <strong>required</strong>
                </div>
            </div>

        </div>
        <div class="form-row">
            <div class="form-group col-md-6 text-left">
                <label for="name" class="links text-dark">OTP<span class="required">*</span></label>
                <input type="text" formControlName="otp" class="form-control" placeholder="Enter OTP" required>
                <div *ngIf="product.otp.touched && product.otp.invalid" class="error">
                    <div *ngIf="product.otp.errors && product.otp.errors.required ">
                        OTP is <strong>required</strong>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-6 text-left">
                <button type="button" class="btn btn-primary mt-4" (click)="sendOTP();" style="margin-top: 28px;">Send
                    OTP</button>
            </div>
        </div>
    </form>
    <p-footer>
        <button [disabled]="buyProductForm.invalid" type="button" pButton icon="pi pi-check" label="Buy"
            (click)="submitProduct();"></button>
        <button type="button" pButton icon="pi pi-close" (click)="buyProduct=false" label="Cancel"
            class="ui-button-secondary"></button>
    </p-footer>
</p-dialog>

<p-toast [style]="{marginTop: '80px'}"></p-toast>
<app-loader [loader]="loader"></app-loader>
<app-alert [sharedAlert]="policyService.showAlert" *ngIf="policyService.showAlert?.modalShow"></app-alert>